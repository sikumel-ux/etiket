function doGet(e) {
  var p = e.parameter.p;
  
  try {
    // ID Spreadsheet kamu sudah saya masukkan di sini
    var ss = SpreadsheetApp.openById("1c0G-3sszFQSrRkwGcT09_u7d9_Hwly92Jwy9D4_1REc"); 
    var sheet = ss.getSheetByName("Users");
    
    if (!sheet) {
      return res({status: "error", message: "Tab 'Users' tidak ditemukan di Sheets"});
    }

    var data = sheet.getDataRange().getValues();

    if (p === 'login') {
      var u = e.parameter.u;
      var ps = e.parameter.ps;
      
      // Loop mulai dari baris kedua (indeks 1) karena baris pertama adalah header
      for (var i = 1; i < data.length; i++) {
        var userInSheet = data[i][0] ? data[i][0].toString() : "";
        var passInSheet = data[i][1] ? data[i][1].toString() : "";
        var namaUser = data[i][2] ? data[i][2].toString() : "User";

        if (userInSheet === u && passInSheet === ps) {
          return res({ 
            status: "success", 
            nama: namaUser 
          });
        }
      }
      return res({ status: "fail", message: "Username atau Password salah" });
    }
    
    // Default response jika parameter p bukan 'login'
    return res({status: "error", message: "Parameter tidak dikenali"});

  } catch (err) {
    return res({status: "error", message: err.toString()});
  }
}

function res(obj) {
  return ContentService.createTextOutput(JSON.stringify(obj))
    .setMimeType(ContentService.MimeType.JSON);
}
          
